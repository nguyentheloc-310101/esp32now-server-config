<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="../../index.css" />
    <link
      rel="stylesheet"
      href="wifi-config.css" />
    <title>Smart Home</title>
  </head>
  <body>
    <!-- SIDEBAR -->
    <section id="sidebar">
      <a
        href="#"
        class="brand">
        <img
          class="logo"
          src="../../../public/images/logo2.png" />
        <span class="text">Smart Home</span>
      </a>
      <ul class="side-menu top">
        <li>
          <a href="../home/home.html">
            <img
              class="bx sidebar-icon"
              src="../../../public/icons/bxs-dashboard.svg" />
            <span class="text">Dashboard</span>
          </a>
        </li>
        <li>
          <a href="../devices/devices.html">
            <img
              class="bx sidebar-icon"
              src="../../../public/icons/bx-devices.svg" />
            <span class="text">Devices</span>
          </a>
        </li>
        <li class="active">
          <a href="../wifi-config/wifi-config.html">
            <img
              class="bx sidebar-icon"
              src="../../../public/icons/bx-wifi.svg" />
            <span class="text">Wifi configuration</span>
          </a>
        </li>
      </ul>
    </section>
    <!-- SIDEBAR -->

    <!-- CONTENT -->
    <section id="content">
      <!-- NAVBAR -->
      <nav>
        <i class="bx bx-menu">
          <img
            class="bx sidebar-icon"
            src="../../../public/icons/bx-menu.svg" />
        </i>
        <a
          href="#"
          class="nav-link"></a>
        <form action="#">
          <div class="form-input">
            <input
              type="search"
              placeholder="Search..." />
            <button
              type="submit"
              class="search-btn">
              <img
                class="bx sidebar-icon"
                src="../../../public/icons/bx-search.svg" />
            </button>
          </div>
        </form>
      </nav>
      <!-- NAVBAR -->

      <!-- MAIN -->
      <main>
        <div class="head-title">
          <div class="left">
            <h1>Wifi Configuration</h1>
            <ul class="breadcrumb">
              <li>
                <a href="../home/home.html">Dashboard</a>
              </li>
              <li>
                <i class="bx bx-chevron-right">
                  <img
                    class="bx sidebar-icon"
                    src="../../../public/icons/bx-chevron-right.svg"
                /></i>
              </li>
              <li>
                <a
                  class="active"
                  href="#"
                  >Wifi Configuration</a
                >
              </li>
            </ul>
          </div>
        </div>
        <form class="container-vs2">
          <div
            class="container-lv1-vs2"
            style="max-width: 1000px">
            <div class="md:flex w-full">
              <div class="img-wifi-config">
                <img src="../../../public/icons/wifi-config.svg" />
              </div>
              <div class="header-vs2-wifi-config">
                <div class="title-vs2-form-wifi-config">
                  <h2 class="title-big">ESP32 config WiFi</h2>
                  <p class="sub-big-title">Wifi Manager</p>
                </div>
                <div class="responsive-lv1">
                  <div class="form-lv1">
                    <div class="md-col-span-5">
                      <label
                        for="wifi"
                        class="wifi-select">
                        Wifi:
                      </label>
                      <select
                        required
                        name="wifiSelect"
                        id="wifiSelect"
                        class="content-select-wifi"></select>
                    </div>
                    <div class="md-col-span-5">
                      <label for="email">Password</label>
                      <input
                        required
                        type="password"
                        name="pass"
                        id="pass"
                        class="input-form-item"
                        placeholder="Fill your Password" />
                    </div>

                    <div class="md-col-span-5 text-left flex-between">
                      <div>
                        <p
                          class="nav-link"
                          id="scan-wifi">
                          Scan WiFi's
                        </p>
                        <p>
                          Connected to:
                          <span
                            class="wifi-name"
                            id="wifi-name"
                            >The coffee house</span
                          >
                        </p>
                      </div>
                      <div class="form-wifi-config-button-css-position">
                        <button
                          class="button-primary"
                          type="submit">
                          Connect
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
        <!-- <form class="container-lv1">
          <div>
            <h2 class="title-big">ESP32 Wifi configuration</h2>
            <p class="sub-big-title">Information of your Wifi.</p>
            <div class="bg-form-input">
              <div class="bg-form-input-lv1">
                <div class="text-gray-600">
                  <p class="text-title-small">Wifi Details</p>
                  <p>
                    Connected to:
                    <span
                      class="wifi-name"
                      id="wifi-name"
                      >The coffee house</span
                    >
                  </p>
                </div>

                <div class="responsive-lv1">
                  <div class="form-lv1">
                    <div class="md-col-span-5">
                      <label
                        for="wifi"
                        class="wifi-select">
                        Wifi:
                      </label>
                      <select
                        required
                        name="wifiSelect"
                        id="wifiSelect"
                        class="content-select-wifi"></select>
                    </div>
                    <div class="md-col-span-5">
                      <label for="email">Password</label>
                      <input
                        required
                        type="password"
                        name="pass"
                        id="pass"
                        class="input-form-item"
                        placeholder="Fill your Password" />
                    </div>

                    <div class="md-col-span-5 text-right flex-between">
                      <p
                        class="nav-link"
                        id="scan-wifi">
                        Scan WiFi's
                      </p>

                      <div class="form-wifi-config-button-css-position">
                        <button
                          class="button-primary"
                          type="submit">
                          Connect
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form> -->
        <!-- </div> -->
      </main>
      <!-- MAIN -->
    </section>
    <!-- CONTENT -->

    <script src="../../index.js"></script>
    <script src="wifi-config.js"></script>
    <script>
      // Fetch the JSON data
      const wifiSelectElement = document.getElementById('wifiSelect');
      const wifiNameElement = document.getElementById('wifi-name');
      const scanWifiElement = document.getElementById('scan-wifi');
      const loadingIndicator = document.createElement('div');
      loadingIndicator.classList.add('loading-indicator');
      loadingIndicator.innerHTML = 'Loading...';

      // Fetch the JSON data
      function fetchWifiData() {
        // Show the loading indicator
        scanWifiElement.appendChild(loadingIndicator);

        // Simulate a delay of 3 seconds
        setTimeout(() => {
          fetch('wifi-config.json')
            .then((response) => response.json())
            .then((data) => {
              // Populate select options from JSON data
              populateWifiOptions(data.listWifi);

              // Set the initially connected WiFi name
              wifiNameElement.textContent = data.connected.name;

              // Hide the loading indicator
              scanWifiElement.removeChild(loadingIndicator);
            })
            .catch((error) => {
              console.error('Error fetching data:', error);
              // Hide the loading indicator
              scanWifiElement.removeChild(loadingIndicator);
            });
        }, 2000);
      }

      function populateWifiOptions(data) {
        const select = document.getElementById('wifiSelect');
        select.innerHTML = '';

        data.forEach((wifi) => {
          const option = document.createElement('option');
          option.value = wifi.name;
          option.text = wifi.name;
          select.appendChild(option);
        });
      }

      function updateConnectedWifi() {
        const selectedWifi = wifiSelectElement.value;
        wifiNameElement.textContent = selectedWifi;
      }

      scanWifiElement.addEventListener('click', fetchWifiData);
      wifiSelectElement.addEventListener('change', updateConnectedWifi);

      // Initial fetch of WiFi data
      fetchWifiData();
    </script>
  </body>
</html>
